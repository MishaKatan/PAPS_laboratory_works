# Лабораторная работа №2  
**Тема:** Использование нотации C4 model для проектирования архитектуры программной системы  
**Цель работы:** Получить опыт использования графической нотации для фиксации архитектурных решений.  
## Диаграмма системного контекста
### Акторы (Person):
1. Студент (Person)
    - Заполняет профиль и загружает резюме (PDF).
    - Выбирает 3 приоритетные компании.
    - Смотрит статус своей заявки и итог распределения.
2. Менеджер практики (Person)
    - Создаёт кампании распределения по годам.
    - Добавляет/редактирует компании и их вместимость.
    - Просматривает и скачивает резюме студентов.
    - Управляет приоритетами и статусами, формирует результаты распределения.
3. Работодатель (Person)
    - Не взаимодействует с системой напрямую.
    - Получает письма с резюме от менеджера через почтовую систему.
    - Дальше общается с менеджером любыми внешними средствами (почта, тг).
### Внешние системы (Software System):
4. Почтовый сервер (External Software System)
    - Принимает письма от нашей системы и доставляет их работодателям.
5. Корпоративная учётная система
    - Может использоваться для аутентификации студентов/менеджеров (потенциально, если будет время)

![Диаграмма системного контекста C4.png](../images/%D0%94%D0%B8%D0%B0%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B0%20%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%BD%D0%BE%D0%B3%D0%BE%20%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%BA%D1%81%D1%82%D0%B0%20C4.png)

# Диаграмма контейнеров
Диаграмма контейнеров отображает основные исполняемые части системы распределения студентов на практику и сетевые взаимодействия между ними. Архитектура реализована как web-приложение, развёрнутое в виде набора Docker-контейнеров за реверс-прокси, с отдельными контейнерами фронтенда, бэкенда и базы данных, а также интеграцией с внешними инфраструктурными сервисами (DNS, почтовый сервер, сервис аутентификации).  
### Браузер пользователя
Браузер выступает клиентским контейнером, через который студенты и менеджеры получают доступ к системе по URL https://internship-distribution.hse-perm.ru. Браузер выполняет загрузку статических ресурсов фронтенда и отправляет REST-запросы к API системы, используя протокол HTTPS.
### DNS-сервер
DNS-сервер – внешний инфраструктурный контейнер, разрешающий доменное имя системы в IP-адрес сервера. При обращении к домену браузер выполняет DNS-запрос, после чего по полученному IP устанавливает HTTPS-соединение с реверс-прокси.  
### Реверс-прокси nginx-proxy
Контейнер nginx-proxy выполняет роль реверс-прокси и входной точки в систему. В нём:
- завершается HTTPS-соединение и хранится SSL-сертификат для домена системы;


- настроено маршрутизирование запросов:


    - запросы к / проксируются в контейнер фронтенда по HTTP на порт 3000;


    - запросы к /api проксируются в контейнер бэкенда по HTTP на порт 8080.


Тем самым nginx-proxy изолирует внутренние сервисы от внешней сети и обеспечивает единый публичный endpoint.
### Контейнер фронтенда (app-frontend-container)
app-frontend-container содержит приложение, реализованное на React и отдаваемое через встроенный Nginx. Фронтенд отвечает за пользовательский интерфейс для двух ролей – студента и менеджера: формы заполнения анкеты, загрузки резюме, выбора приоритетных компаний, просмотра статусов заявок и результатов распределения.
Фронтенд взаимодействует с бэкендом по протоколу HTTPS, отправляя REST-запросы к маршрутам /api/... через nginx-proxy и обмениваясь данными в формате JSON.
### Контейнер бэкенда (app-backend-container)
app-backend-container содержит серверное приложение на ASP.NET Core Web API. Этот контейнер реализует основную бизнес-логику системы:
- управление пользователями и ролями (студент, менеджер);


- управление распределительными кампаниями по годам;


- работа с компаниями и их участием в кампаниях (количество мест, вакансии);


- обработка заявок студентов и их приоритетов;


- формирование наборов резюме для работодателей;


- взаимодействие с базой данных, файловым хранилищем и почтовым сервером.


Все запросы от фронтенда проходят через nginx-proxy и перенаправляются в этот контейнер по HTTP.
### База данных PostgreSQL
PostgreSQL Database – отдельный контейнер СУБД, используемый бэкендом для долговременного хранения данных. В базе содержатся сведения о пользователях, студентах, менеджерах, компаниях, кампаниях распределения, заявках, приоритетах, а также имена файлов резюме. Доступ к БД осуществляется только из контейнера бэкенда по протоколу TCP/SQL через уровень ORM (Entity Framework Core).
### Файловое хранилище резюме
File Storage представляет собой файловую систему сервера / Docker-том, в котором физически хранятся загруженные студентами PDF-резюме. Бэкенд записывает и читает файлы через файловый интерфейс, а в базе данных фиксируются только имена файлов и служебные атрибуты. Такое разделение позволяет разграничить структурированные данные и бинарный контент (файлы).
### Почтовая система
E-mail System – внешний контейнер почтового сервера (SMTP), через который система рассылает письма. Бэкенд формирует письма с прикреплёнными резюме студентов и отправляет их работодателям, а также может рассылать сервисные уведомления студентам и менеджерам. Почтовый сервер отвечает за доставку сообщений адресатам.
### Внешний сервис аутентификации (SSO)
Сервис аутентификации университета (SSO) – внешний программный сервис, используемый для проверки подлинности пользователей. При входе в систему студент или менеджер перенаправляется на страницу SSO (через браузер), вводит учетные данные, после чего получает токен аутентификации.
Бэкенд проверяет валидность токена и извлекает информацию о пользователе и его ролях. Это позволяет:
- не хранить пароли пользователей внутри системы распределения;
- интегрироваться с существующей инфраструктурой университета;
- централизованно управлять учётными записями.
## Выбор архитектурного стиля и топологии
Архитектура системы реализована в стиле слоистого веб-приложения (layered client–server) с чётким разделением на:
- слой представления (React-фронтенд в отдельном контейнере);
- слой прикладной логики (ASP.NET Core Web API в контейнере бэкенда);
- слой данных (PostgreSQL и файловое хранилище резюме).

Поверх этого добавлен инфраструктурный слой, включающий реверс-прокси nginx-proxy, внешний почтовый сервер и сервис аутентификации SSO.
Выбранная топология предусматривает несколько модулей развертывания и насыщенное сетевое взаимодействие:
- браузер обращается к доменному имени системы и через DNS и nginx-proxy попадает на фронтенд и API;
- фронтенд и бэкенд развёрнуты в отдельных Docker-контейнерах и взаимодействуют по HTTP/HTTPS;
- бэкенд по сети обращается к контейнеру PostgreSQL, к файловому хранилищу, к почтовому серверу и к сервису SSO.

Такое решение обеспечивает:
- гибкое масштабирование фронтенда и бэкенда независимо друг от друга;
- ясное разделение ответственности между слоями;
- возможность повторного использования инфраструктурных сервисов (SSO, SMTP);
- упрощённый деплой за счёт контейнеризации (Docker Compose).

Для учебного проекта данный архитектурный стиль является оптимальным компромиссом между сложностью и реалистичностью промышленной веб-архитектуры.

![Диаграмма контейнеров(c4).png](../images/%D0%94%D0%B8%D0%B0%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B0%20%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80%D0%BE%D0%B2%28c4%29.png)

# Диаграмма компонентов (backend)  
Диаграмма компонентов детализирует внутреннюю структуру контейнера
 **app-backend-container**, реализующего серверную часть системы распределения студентов. Для наглядности backend представлен в виде трёх логических слоёв: слой контроллеров (API-интерфейс), слой сервисов (бизнес-логика) и слой доступа к данным (Persistence Layer), а также два инфраструктурных компонента для работы с файловым хранилищем и почтовым сервером.  
### Контроллеры
В слой контроллеров входят укрупнённые компоненты **Auth API, Student API, Management API и Distribution API,** которые принимают HTTP-запросы от фронтенда и отвечают за авторизацию, работу с профилем студента и его резюме, управление организациями и кампаниями по распределению, а также операции с заявками и экранами менеджера. Каждый из контроллеров не содержит бизнес-логики, а делегирует обработку данных соответствующим сервисам.  
### Сервисы
Слой сервисов образуют компоненты **Auth Service, Student Service, Company & Campaign Service, Application Lifecycle Service, Distribution Query Service и Email Notification Service.** Они инкапсулируют основную бизнес-логику системы: аутентификацию и интеграцию с SSO, работу со студентами и их резюме, управление организациями и кампаниями, обработку жизненного цикла заявок на распределение, формирование выборок и отчётов для менеджера, а также подготовку и отправку уведомлений по e-mail.
### Репозитории
Все сервисы обращаются к укрупнённому компоненту **Persistence Layer,** который представляет собой слой доступа к данным (контекст базы данных и набор специализированных репозиториев), взаимодействующий с PostgreSQL Database. Для работы с файлами резюме используется компонент File Storage Adapter, обеспечивающий доступ к внешнему контейнеру File Storage.  
Важно отметить, что на диаграмме намеренно показано сокращённое число компонентов (укрупнённые API и сервисы), чтобы сохранить читаемость и сосредоточиться на ключевой структуре системы. В реальной программе количество компонентов больше: каждый укрупнённый блок соответствует нескольким конкретным контроллерам, сервисам и репозиториям, реализованным в коде, но на диаграмме они объединены в логические группы.  

![Диаграмма компонентов (c4).png](../images/%D0%94%D0%B8%D0%B0%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B0%20%D0%BA%D0%BE%D0%BC%D0%BF%D0%BE%D0%BD%D0%B5%D0%BD%D1%82%D0%BE%D0%B2%20%28c4%29.png)

# Диаграмма компонентов (frontend)
Диаграмма компонентов детализирует внутреннюю структуру контейнера
 **app-frontend-container**, реализующего клиентскую часть системы распределения студентов.
 Фронтенд построен по компонентному принципу и логически разделён на три подсистемы:  
- маршрутизация и оболочка приложения
- страницы (feature-компоненты)
- сервисный слой для работы с API  

## Компоненты пользовательского интерфейса и маршрутизации
### App Router
 Отвечает за маршрутизацию внутри одностраничного приложения (SPA). Определяет набор маршрутов для студентов и менеджеров **(/login, /menu, /companies, /profile, /priorities, /results и т.д.)** и выбирает, какую страницу отрисовать в зависимости от URL. Оборачивает защищённые страницы в общий макет приложения.
### Layout Shell
 Общий каркас страниц после авторизации. Содержит основную разметку приложения и подключает шапку, подвал и область контента, в которой отображаются конкретные страницы для студента или менеджера.
### Shared UI Components
 Набор переиспользуемых элементов интерфейса:  
- Header (отображение логотипа, e-mail и роли текущего пользователя, кнопка выхода);
- Footer (подвал сайта);
- ErrorAlert (отображение ошибок);
- ResumeUploader (загрузка, удаление и скачивание резюме).

 Эти компоненты используются на разных страницах и обеспечивают единый стиль и поведение UI.
## Страницы
### Auth Pages  
 Компонент страницы авторизации. Отображает форму логина, отправляет введённые данные в сервис авторизации, обрабатывает ошибки (через ErrorAlert) и при успешном входе перенаправляет пользователя в основное меню.
### Student Pages
 Набор страниц для роли «Студент»: главное меню, профиль/резюме, выбор приоритетных компаний, просмотр статуса и итогов распределения. Эти страницы используют сервисы фронтенда для получения данных профиля, работы с резюме, списком компаний и результатами распределения.
### Manager Pages
 Набор страниц для роли «Менеджер»: меню менеджера, управление компаниями, просмотр списка студентов, управление учётными записями пользователей и просмотр итогов распределения. Компоненты страниц обращаются к сервисам фронтенда для выполнения соответствующих операций через backend API.
## Сервисный слой фронтенда
### API Client
 Обёртка над HTTP-клиентом (например, Axios). Отвечает за отправку запросов на backend API: задаёт базовый URL, добавляет JWT-токен в заголовки, обрабатывает ошибки и, при необходимости, выполняет перенаправление на страницу логина при ответах 401/403.
### Auth Service
 Инкапсулирует работу с аутентификацией на стороне клиента: отправляет запросы логина/логаута, сохраняет и читает токен из localStorage, предоставляет информацию о текущем пользователе (e-mail, роль) для UI. Используется страницами авторизации и компонентом Header.
### Student Service
 Реализует запросы к backend API, связанные со студентами: получение и обновление данных текущего студента, загрузка, скачивание и удаление резюме. Используется студенческими страницами и компонентом ResumeUploader.
### Companies & Distribution Service
 Отвечает за взаимодействие с backend API в части компаний и распределения: получение списка компаний, отправку приоритетов, получение статусов заявок и итоговых результатов распределения, выборки студентов для менеджера. Используется как студенческими, так и менеджерскими страницами.
### Users Management Service
 Инкапсулирует запросы к backend API по управлению учётными записями и ролями пользователей. Применяется на страницах менеджера, связанных с администрированием пользователей.
Все сервисы фронтенда используют общий API Client для отправки HTTP(S)-запросов к контейнеру Backend API и обмена данными в формате JSON.
## Внешняя зависимость
На диаграмме компонентов фронтенда показан внешний контейнер Backend API, который предоставляет REST-интерфейсы для всех операций приложения. Компонент API Client является точкой интеграции фронтенда с серверной частью и обеспечивает единообразный доступ к этим интерфейсам

Как и в случае с backend-диаграммой, на диаграмме компонентов фронтенда представлено **укрупнённое множество компонентов.** В реальном React-проекте количество конкретных компонентов (страниц, виджетов и вспомогательных модулей) больше, однако для сохранения наглядности и соответствия уровню C4 отдельные файлы и мелкие компоненты объединены в логические группы (Auth Pages, Student Pages, Manager Pages, Shared UI Components и др.). Это позволяет показать архитектуру клиентской части системы на концептуальном уровне, не перегружая диаграмму деталями реализации.

![Диаграмма компонентов frontend (c4).png](../images/%D0%94%D0%B8%D0%B0%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B0%20%D0%BA%D0%BE%D0%BC%D0%BF%D0%BE%D0%BD%D0%B5%D0%BD%D1%82%D0%BE%D0%B2%20frontend%20%28c4%29.png)